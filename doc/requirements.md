# 投資リターン計算機 要件定義書

## 1. プロジェクト概要

### 1.1 目的
個人の投資計画・資産形成をサポートするWebアプリケーション。将来の資産形成をシミュレーションし、計画的な投資を支援する。

### 1.2 ターゲットユーザー
- 投資初心者から経験者まで幅広く対応
- 年齢層・投資経験レベルは問わない
- 個人の資産形成に関心がある全ての人

### 1.3 解決する課題
- 複雑な複利計算を簡単に実行
- 長期的な資産形成の見える化
- 複数の投資シナリオの比較検討

## 2. 機能要件

### 2.1 必須機能（MVP）

#### 2.1.1 計算機能
- **単利計算**
  - 初期投資額からの単純な利益計算
  - 年利率での計算

- **複利計算**
  - 年複利計算（デフォルト）
  - 月複利計算（オプション）
  - 複利周期の選択機能

- **定期積立計算**
  - 毎月固定額の積立
  - ボーナス月の追加積立（任意の月を複数選択可能）

#### 2.1.2 入力項目
- 初期投資額
- 年利率（％）
- 投資期間（年）
- 毎月積立額
- ボーナス積立額（オプション）
- ボーナス支給月の選択（任意月、複数選択可能）

#### 2.1.3 表示機能
- **数値表示**
  - 最終資産額
  - 元本総額
  - 利益総額
  - 利益率

- **グラフ表示**
  - 資産推移の時系列グラフ
  - 元本と利益の内訳（積み上げグラフ）
  - レスポンシブ対応

#### 2.1.4 データ管理
- 計算結果の自動保存・復元（LocalStorage）
- フォーム入力データの自動保存・復元
- CSVエクスポート機能
- 複数シミュレーションの保存・管理
- 保存データの一括クリア機能

#### 2.1.5 UI/UX
- プロフェッショナルなデザイン
- モバイルレスポンシブ対応
- ダークモード対応
- PWA対応（ホーム画面追加・オフライン動作）
- 日本語バリデーションメッセージ

### 2.2 追加機能（Phase 2）

#### 2.2.1 比較機能
- 複数シナリオの同時比較
- 比較グラフの表示

#### 2.2.2 税金計算
- 源泉徴収税（20.315%）の考慮
- 税引き後リターンの表示

#### 2.2.3 インフレ考慮
- インフレ率の入力
- 実質リターンの計算

#### 2.2.4 多言語対応
- 日本語（デフォルト）
- 英語
- 中国語（繁体字）※台湾向け

## 3. 非機能要件

### 3.1 パフォーマンス
- 計算結果の即時表示（1秒以内）
- スムーズなグラフアニメーション

### 3.2 ユーザビリティ
- 直感的な操作性
- 入力値のリアルタイムバリデーション
- ツールチップによる説明表示

### 3.3 アクセシビリティ
- キーボード操作対応
- スクリーンリーダー対応

### 3.4 ブラウザ対応
- Chrome（最新版）
- Safari（最新版）
- Firefox（最新版）
- Edge（最新版）
- PWA対応（ホーム画面インストール）
- Service Worker対応（オフラインキャッシュ）

## 4. 技術仕様

### 4.1 技術スタック
- **フレームワーク**: Next.js 14+ (App Router)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **グラフライブラリ**: Recharts
- **状態管理**: Zustand
- **フォームバリデーション**: React Hook Form + Zod
- **PWA**: Web App Manifest + Service Worker
- **多言語化**: 日本語（メイン）、将来的に多言語対応

### 4.2 デプロイ環境
- Vercel（推奨）
- 静的サイト生成（SSG）

## 5. 画面構成

### 5.1 メイン画面
- 入力フォームエリア
- 計算結果表示エリア
- グラフ表示エリア

### 5.2 履歴画面
- 保存済みシミュレーション一覧
- 詳細表示・編集・削除機能

### 5.3 比較画面（追加機能）
- 複数シミュレーションの選択
- 比較グラフ・テーブル表示

## 6. データモデル

### 6.1 シミュレーションデータ
```typescript
interface Simulation {
  id: string;
  name: string;
  createdAt: Date;
  updatedAt: Date;
  parameters: {
    initialAmount: number;        // 初期投資額
    annualRate: number;          // 年利率
    investmentPeriod: number;    // 投資期間（年）
    monthlyDeposit: number;      // 月額積立額
    bonusDeposit?: number;       // ボーナス積立額
    bonusMonths?: number[];      // ボーナス支給月（1-12）
    compoundFrequency: 'yearly' | 'monthly'; // 複利計算頻度
    calculationType: 'simple' | 'compound';  // 計算種別
  };
  results: {
    finalAmount: number;         // 最終資産額
    totalPrincipal: number;      // 元本総額
    totalProfit: number;         // 利益総額
    profitRate: number;          // 利益率
    yearlyBreakdown: YearlyData[]; // 年次推移データ
  };
}

interface YearlyData {
  year: number;
  principal: number;
  profit: number;
  total: number;
}
```

## 7. 成功基準

### 7.1 定量的基準
- 計算精度: 小数点以下2桁まで正確
- レスポンス速度: 1秒以内
- モバイル対応: 画面幅320px以上で正常表示

### 7.2 定性的基準
- ユーザーが迷わず操作できる
- 計算結果が視覚的に理解しやすい
- プロフェッショナルな外観

## 8. 制約事項
- ブラウザのLocalStorageの容量制限（5MB程度）
- PWA・Service Worker対応によるオフライン環境での動作保証
- 個人情報は収集・保存しない
- HTTPS環境でのPWA機能動作（開発時：自己署名証明書、本番：Vercel）

## 9. 今後の拡張可能性
- ユーザーアカウント機能
- クラウド同期
- AIによる投資アドバイス機能
- 実際の株価・為替データとの連携
- ポートフォリオ管理機能

## 10. スケジュール（想定）
- Phase 1（MVP）: 2-3週間
  - Week 1: 環境構築・基本機能実装
  - Week 2: グラフ・データ管理機能
  - Week 3: UI仕上げ・テスト
- Phase 2（追加機能）: 1-2週間
  - 優先度に応じて段階的に実装